<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>005 Apache VirtualHost configuration</title>
    <meta name="description" content="Suppose someone to assert: The gostak distims the doshes. You do not know what this means; nor do I. But if we assume that it is English, we know that the doshes are distimmed by the gostak. We know too that one distimmer of doshes is a gostak. If, moreover, the doshes are galloons, we know that some galloons are distimmed by the gostak. And so we may go on, and so we often do go on.
">

    <link rel="shortcut icon" href="/donakis/favicon.ico"/>
    <!--<link rel="stylesheet" href="/donakis/css/style.css">-->
    <!--<link rel="stylesheet" href="/donakis/css/collapse.css">-->
    <link rel="stylesheet" href="/donakis/css/main.css">
    <link rel="canonical" href="http://yourdomain.com/donakis/mailserver/startssl-crt/005-apache-virtual-host-on-secured-port.html">

    <!--<script src="/donakis/scripts/highlight.pack.js"></script>-->
    <script src="/donakis/scripts/modernizr.js"></script>



    <script>   
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        // My customisation
        if( location.hostname.match( 'maripac.github.io/donakis/' ) ) {
          ga('create', 'UA-57199073-1', 'maripac.github.io/donakis/');
        }
        else {
          ga('create', 'UA-57069300-1', 'gostak.io/');
        }
        // My customisation END

        ga('send', 'pageview');
    </script>
<!--<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57069300-1', 'auto');
  ga('send', 'pageview');

</script>-->
<!--<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57199073-1', 'auto');
  ga('send', 'pageview');

</script>-->

</head>


  <body>

    <div id="outer-wrap">
      <div id="inner-wrap">


      <header class="site-header" id="top" role="banner">


  <div class="block">

    <div class="inner-header">
      <a class="site-header-inner" href="/donakis/">
      <h1>gostak.io</h1>
      <h6>when gostaks dream of electric doshes...</h6>
      </a>
    </div>
    
    <a class="nav-btn" id="nav-open-btn" href="#nav">Book Navigation</a>
  </div>


<!--<header class="site-header"> A-->

  

  <!--<div class="wrapper">

    <a class="site-title" href="/donakis/">gostak.io</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>


      <div class="trigger">
        
          
          <a class="page-link" href="/donakis/about/">About</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/donakis/series/">Series</a>
          
        
          
        
      </div>

    </nav>

  </div>-->

<!--</header> A-->


</header>


<nav id="nav" role="navigation">
<div class="block">



<!--<div class="wrapper">-->

    

    <!--<nav class="site-nav">-->
      <!--<a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>-->


      <div class="trigger">
        <a class="page-link" href="/donakis/">home</a>
        
          
          <a class="page-link" href="/donakis/about/">About</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/donakis/series/">Series</a>
          
        
          
        
        <!--<a class="site-title page-link" href="/donakis/">gostak.io</a>-->
        
      </div>

    <!--</nav>-->

<!--</div>-->



<a class="close-btn" id="nav-close-btn" href="#top">Return to Content</a>
</div>
</nav>


        <div id="main" role="main">
          <article class="block prose">

            <div class="page-content">
              <div class="wrapper">
                <div class="post">
    <h2 class="in_series">005 Apache VirtualHost configuration</h2>

<ul class="post-list_aside">
 
    
        


    
        
        
                <li>
            <!--<span class="post-meta">Nov 27, 2014</span>-->

            
              <a class="post-link-aside" href="/donakis/mailserver/startssl-crt/000-intro-and-resources.html"><span class="numbered">0</span> &mdash; Intro and resources</a>
              <!--<span class="post-meta">Nov 27, 2014</span>-->

            
        </li>
        

        


    
        
        
                <li>
            <!--<span class="post-meta">Nov 27, 2014</span>-->

            
              <a class="post-link-aside" href="/donakis/mailserver/startssl-crt/001-options-for-enabling-secure-connections-TLS.html"><span class="numbered">1</span> &mdash; Options for enabling TLS</a>
              <!--<span class="post-meta">Nov 27, 2014</span>-->

            
        </li>
        

        


    
        
        
                <li>
            <!--<span class="post-meta">Nov 27, 2014</span>-->

            
              <a class="post-link-aside" href="/donakis/mailserver/startssl-crt/002-creating-the-private-key-and-request-crs-locally.html"><span class="numbered">2</span> &mdash; Private key and certificate request</a>
              <!--<span class="post-meta">Nov 27, 2014</span>-->

            
        </li>
        

        


    
        
        
                <li>
            <!--<span class="post-meta">Nov 27, 2014</span>-->

            
              <a class="post-link-aside" href="/donakis/mailserver/startssl-crt/003-startssl-authentication-and-validation.html"><span class="numbered">3</span> &mdash; Authentication and Validation</a>
              <!--<span class="post-meta">Nov 27, 2014</span>-->

            
        </li>
        

        


    
        
        
                <li>
            <!--<span class="post-meta">Nov 27, 2014</span>-->

            
              <a class="post-link-aside" href="/donakis/mailserver/startssl-crt/004-obtaining-the-certificate-signed-by-startssl.html"><span class="numbered">4</span> &mdash; Processing the Certificate Request</a>
              <!--<span class="post-meta">Nov 27, 2014</span>-->

            
        </li>
        

        


    
        
        

        <li class="active">
            <!--<span class="post-meta">Nov 27, 2014</span>-->

            
              <a class="post-link-aside" href="#"><span class="numbered">5</span> &mdash; Apache configuration</a>
              <!--<span class="post-meta">Nov 27, 2014</span>-->

            
        </li>
        

        


    
        
        
                <li>
            <!--<span class="post-meta">Nov 27, 2014</span>-->

            
              <a class="post-link-aside" href="/donakis/mailserver/startssl-crt/006-on-trusted-authorities-and-the-chain-of-trust.html"><span class="numbered">6</span> &mdash; On trusted Authorities</a>
              <!--<span class="post-meta">Nov 27, 2014</span>-->

            
        </li>
        

        


    
</ul>

  <article class="post-content">
    <p>After you finish the whole process. You should have the following files.</p>

<ul>
  <li><code>/etc/ssl/certs/private/webserver.pem</code></li>
  <li><code>/etc/ssl/certs/webserver.pem</code></li>
  <li><code>/etc/ssl/certs/sub.class1.web.ca.pem</code></li>
  <li><code>/etc/ssl/certs/webca.pem</code></li>
</ul>

<p>Neither the encrypted private key, nor the request .csr file are needed anymore. The root certificate, is not going to be needed for the Apache VirtualHost setup. But keep it near because it will be needed later. Now you could scp them to your vps, and store them maintaining the same structure of directories. </p>

<p>To scp files from local to a remote server, the destination folder must exist in the remote machine. One way to do this is by cd’ing to your local directory /etc/ssl/certs/private/ and ssh’ing to your vps to create the destination folder. </p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">cd</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">ssl</span><span class="o">/</span><span class="nx">certs</span><span class="o">/</span><span class="nx">private</span>
<span class="nx">$</span> <span class="nx">ssh</span> <span class="nx">user@mydomain</span>
<span class="nx">$</span> <span class="nx">mkdir</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">ssl</span><span class="o">/</span><span class="nx">certs</span><span class="o">/</span><span class="nx">private</span></code></pre></div>

<p>Logout, and back at your local system upload the decrypted private key:</p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">scp</span> <span class="nx">webserver</span><span class="p">.</span><span class="nx">pem</span> <span class="nx">user@mydomain</span><span class="o">:/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">ssl</span><span class="o">/</span><span class="nx">certs</span><span class="o">/</span><span class="nx">private</span><span class="o">/</span><span class="nx">webserver</span><span class="p">.</span><span class="nx">pem</span></code></pre></div>

<p>Move to the parent directory to upload the Certificate file, along with the Intermediate CA Certificate, and the Root CA Certificate:</p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">cd</span> <span class="p">..</span> 
<span class="nx">$</span> <span class="nx">scp</span> <span class="nx">webserver</span><span class="p">.</span><span class="nx">pem</span> <span class="nx">user@mydomain</span><span class="o">:/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">ssl</span><span class="o">/</span><span class="nx">certs</span><span class="o">/</span><span class="nx">webserver</span><span class="p">.</span><span class="nx">pem</span>
<span class="nx">$</span> <span class="nx">scp</span> <span class="nx">sub</span><span class="p">.</span><span class="nx">class1</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">ca</span><span class="p">.</span><span class="nx">pem</span> <span class="nx">user@mydomain</span><span class="o">:/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">ssl</span><span class="o">/</span><span class="nx">certs</span><span class="o">/</span><span class="nx">sub</span><span class="p">.</span><span class="nx">class1</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">ca</span><span class="p">.</span><span class="nx">pem</span>
<span class="nx">$</span> <span class="nx">scp</span> <span class="nx">webca</span><span class="p">.</span><span class="nx">pem</span> <span class="nx">user@mydomain</span><span class="o">:/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">ssl</span><span class="o">/</span><span class="nx">certs</span><span class="o">/</span><span class="nx">webca</span><span class="p">.</span><span class="nx">pem</span></code></pre></div>

<p><br /></p>

<h3 id="the-first-part-of-this-section-applies-just-in-a-case-where-you-only-had-one-tls-certificate-per-ip">The first part of this section applies just in a case where you only had one TLS certificate per IP.</h3>

<h6 id="you-can-jump-to-the-next-optionsni-if-that-is-not-your-case">You can jump to the <a href="#sni">next option</a> if that is not your case.</h6>

<p>In normal circumstances, now you could login to your vps and open with a text editor the template file that is used for enabling an apache VirtualHost on port 443, which is the port employed for establishing encrypted connections: </p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">nano</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">apache2</span><span class="o">/</span><span class="nx">sites-available</span><span class="o">/</span><span class="nx">default-ssl</span></code></pre></div>

<p>And update the path to the Private Key, the Certificate File, as well as the Intermediate CA Certificate as follows:</p>

<div class="highlight"><pre><code class="language-apacheconf" data-lang="apacheconf"><span class="nt">&lt;IfModule</span> <span class="s">mod_ssl.c</span><span class="nt">&gt;</span>
<span class="nt">&lt;VirtualHost</span> <span class="s">_default_:443</span><span class="nt">&gt;</span>
        <span class="nb">ServerAdmin</span> webmaster@localhost
        <span class="nb">ServerName</span> www.mydomain.com  
        <span class="nb">DocumentRoot</span> <span class="sx">/var/www/html</span>

        <span class="nb">ErrorLog</span> ${APACHE_LOG_DIR}/error.log

        <span class="c"># Possible values include: debug, info, notice, warn, error, crit,</span>
        <span class="c"># alert, emerg.</span>
        <span class="nb">LogLevel</span> <span class="k">warn</span>

        <span class="nb">CustomLog</span> ${APACHE_LOG_DIR}/ssl_access.log combined

        <span class="c">#   SSL Engine Switch:</span>
        <span class="nb">SSLEngine</span> <span class="k">on</span>

        <span class="nb">SSLProtocol</span> <span class="k">all</span> -SSLv2
        <span class="nb">SSLCipherSuite</span> <span class="k">ALL</span>:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM

        <span class="nb">SSLCertificateFile</span>    <span class="sx">/etc/ssl/certs/webserver.pem</span>
        <span class="nb">SSLCertificateKeyFile</span> <span class="sx">/etc/ssl/certs/private/webserver.pem</span>
        <span class="nb">SSLCertificateChainFile</span> <span class="sx">/etc/ssl/certs/sub.class1.web.ca.pem</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
<span class="nt">&lt;/IfModule&gt;</span></code></pre></div>

<p>To enable this SSL configuration, as well as the ssl module, and reload apache to update the new configuration. </p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">a2ensite</span> <span class="nx">default-ssl</span>
<span class="nx">$</span> <span class="nx">a2enmod</span> <span class="nx">ssl</span>
<span class="nx">$</span> <span class="nx">service</span> <span class="nx">apache2</span> <span class="nx">reload</span></code></pre></div>

<p>At this point, if you haven’t decrypted the private key, you might get an error. To make sure, the Private Key is properly encoded also restart:</p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">service</span> <span class="nx">apache2</span> <span class="nx">restart</span></code></pre></div>

<p>Now you should be able to get an It Works! message if you navigate to https://www.mydomain.com. And finally edit:</p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">nano</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">apache2</span><span class="o">/</span><span class="nx">sites-available</span><span class="o">/</span><span class="nx">default</span></code></pre></div>

<p>To add a redirection statement:</p>

<div class="highlight"><pre><code class="language-apacheconf" data-lang="apacheconf"><span class="nb">Redirect</span> permanent / https://www.mydomain.com/</code></pre></div>

<p>To get apache to apply changes:</p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">service</span> <span class="nx">apache2</span> <span class="nx">reload</span></code></pre></div>

<p><a name="sni"></a></p>

<h3 id="in-order-to-use-more-than-one-tls-certificate-per-ip-we-must-enable-an-extention-of-the-tls-protocol-that-is-known-as-server-name-indication-or-sni">In order to use more than one TLS certificate per IP, we must enable an extention of the TLS protocol that is known as Server Name Indication or SNI.</h3>

<p>You can read more about this implementation of the TLS protocol on the following links:</p>

<ul>
  <li><a href="http://tools.ietf.org/html/rfc4366">RFC 4366</a></li>
  <li><a href="https://wiki.apache.org/httpd/NameBasedSSLVHostsWithSNI">Apache Documentation NameBasedSSLVHostsWithSNI</a></li>
</ul>

<p>In order to configure a second VirtualHost on a 443 port, you should scp the other group of files corresponding to the other TLS connection that you want to enable. In my case: </p>

<ul>
  <li><code>/etc/ssl/certs/private/mailserver.pem</code></li>
  <li><code>/etc/ssl/certs/mailserver.pem</code></li>
  <li><code>/etc/ssl/certs/sub.class1.mail.ca.pem</code></li>
  <li><code>/etc/ssl/certs/mailca.pem</code></li>
</ul>

<p>You can also check out the following tutorial for more details on this configuration:</p>

<p><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-multiple-ssl-certificates-on-one-ip-with-apache-on-ubuntu-12-04">Multiple SSL Certificates on one IP</a></p>

<p>The idea is to create two files in <code>/etc/apache2/sites-available</code>. One for each of the Name Based Virtual Host, that you want to provide secure access to. So to keep it intuitive you could create a file at the given location called <code>www.mydomain.com</code>, while the other could be <code>mail.mydomain.com</code>. </p>

<p>Obviously before this whole setup is publicly available from a web client you need to configure the DNS properly. The next file is the one that creates the webserver VirtualHost, called <code>www.mydomain.com</code>.  </p>

<div class="highlight"><pre><code class="language-apacheconf" data-lang="apacheconf"><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
        <span class="nb">ServerAdmin</span> webmaster@localhost
        <span class="nb">ServerName</span> www.mydomain.com  
        <span class="nb">DocumentRoot</span> <span class="sx">/var/www/html</span>

        <span class="nb">ErrorLog</span> ${APACHE_LOG_DIR}/error.log
        <span class="nb">Redirect</span> permanent / https://www.mydomain.com/

        <span class="c"># Possible values include: debug, info, notice, warn, error, crit,</span>
        <span class="c"># alert, emerg.</span>
        <span class="nb">LogLevel</span> <span class="k">warn</span>

        <span class="nb">CustomLog</span> ${APACHE_LOG_DIR}/access.log combined
<span class="nt">&lt;/VirtualHost&gt;</span>

<span class="nt">&lt;IfModule</span> <span class="s">mod_ssl.c</span><span class="nt">&gt;</span>
<span class="nt">&lt;VirtualHost</span> <span class="s">*:443</span><span class="nt">&gt;</span>
        <span class="nb">ServerAdmin</span> webmaster@localhost
        <span class="nb">ServerName</span> www.mydomain.com  
        <span class="nb">DocumentRoot</span> <span class="sx">/var/www/html</span>

        <span class="nb">ErrorLog</span> ${APACHE_LOG_DIR}/error.log

        <span class="c"># Possible values include: debug, info, notice, warn, error, crit,</span>
        <span class="c"># alert, emerg.</span>
        <span class="nb">LogLevel</span> <span class="k">warn</span>

        <span class="nb">CustomLog</span> ${APACHE_LOG_DIR}/ssl_access.log combined

        <span class="c"># SSL Engine Switch:</span>
        <span class="nb">SSLEngine</span> <span class="k">on</span>

        <span class="nb">SSLProtocol</span> <span class="k">all</span> -SSLv2
        <span class="nb">SSLCipherSuite</span> <span class="k">ALL</span>:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM


        <span class="nb">SSLCertificateFile</span>    <span class="sx">/etc/ssl/certs/webserver.pem</span>
        <span class="nb">SSLCertificateKeyFile</span> <span class="sx">/etc/ssl/certs/private/webserver.pem</span>
        <span class="nb">SSLCertificateChainFile</span> <span class="sx">/etc/ssl/certs/sub.class1.web.ca.pem</span>

        <span class="nt">&lt;FilesMatch</span> <span class="s">&quot;\.(cgi|shtml|phtml|php)$&quot;</span><span class="nt">&gt;</span>
                <span class="nb">SSLOptions</span> +StdEnvVars
        <span class="nt">&lt;/FilesMatch&gt;</span>
        <span class="nt">&lt;Directory</span> <span class="s">/usr/lib/cgi-bin</span><span class="nt">&gt;</span>
                <span class="nb">SSLOptions</span> +StdEnvVars
        <span class="nt">&lt;/Directory&gt;</span>
        <span class="c">#   SSL Protocol Adjustments:</span>
        <span class="c">#   o ssl-unclean-shutdown:</span>
        <span class="c">#   o ssl-accurate-shutdown:</span>
        <span class="nb">BrowserMatch</span> <span class="s2">&quot;MSIE [2-6]&quot;</span> \
                <span class="nb">nokeepalive</span> ssl-unclean-shutdown \
                <span class="err">downgrade-1</span>.<span class="err">0</span> <span class="err">force-response-1</span>.<span class="err">0</span>
        <span class="c"># MSIE 7 and newer should be able to use keepalive</span>
        <span class="nb">BrowserMatch</span> <span class="s2">&quot;MSIE [17-9]&quot;</span> ssl-unclean-shutdown

<span class="nt">&lt;/VirtualHost&gt;</span>
<span class="nt">&lt;/IfModule&gt;</span></code></pre></div>

<p>Next, you can create a second one called <code>mail.mydomain.com</code>, following the same parameters with the paths pointing to the right certificates. The following code, also includes the options needed to configure Roundcube, so at this point it won’t work. But we’ll test the TLS connection on the webserver, instead of the mailserver. </p>

<div class="highlight"><pre><code class="language-apacheconf" data-lang="apacheconf"><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
        <span class="nb">ServerAdmin</span> webmaster@localhost
        <span class="nb">Alias</span> <span class="sx">/roundcube/program/js/tiny_mce/</span> <span class="sx">/usr/share/tinymce/www/</span>
        <span class="nb">ServerName</span> mail.mydomain.com
        <span class="nb">DocumentRoot</span> <span class="sx">/var/lib/roundcube</span>

        <span class="nb">ErrorLog</span> ${APACHE_LOG_DIR}/error.log

        <span class="nb">Redirect</span> permanent / https://mail.mydomain.com/

        <span class="c"># Possible values include: debug, info, notice, warn, error, crit,</span>
        <span class="c"># alert, emerg.</span>
        <span class="nb">LogLevel</span> <span class="k">warn</span>

        <span class="nb">CustomLog</span> ${APACHE_LOG_DIR}/access.log combined
<span class="nt">&lt;/VirtualHost&gt;</span>

<span class="nt">&lt;IfModule</span> <span class="s">mod_ssl.c</span><span class="nt">&gt;</span>
<span class="nt">&lt;VirtualHost</span> <span class="s">*:443</span><span class="nt">&gt;</span>
        <span class="nb">ServerAdmin</span> webmaster@localhost
        <span class="nb">Alias</span> <span class="sx">/roundcube/program/js/tiny_mce/</span> <span class="sx">/usr/share/tinymce/www/</span>
        <span class="nb">ServerName</span> mail.mydomain.com
        <span class="nb">DocumentRoot</span> <span class="sx">/var/lib/roundcube</span>

        <span class="nb">ErrorLog</span> ${APACHE_LOG_DIR}/error.log

        <span class="c"># Possible values include: debug, info, notice, warn, error, crit,</span>
        <span class="c"># alert, emerg.</span>
        <span class="nb">LogLevel</span> <span class="k">warn</span>


        <span class="nb">CustomLog</span> ${APACHE_LOG_DIR}/ssl_access.log combined

        <span class="c">#   SSL Engine Switch:</span>
        <span class="c">#   Enable/Disable SSL for this virtual host.</span>
        <span class="nb">SSLEngine</span> <span class="k">on</span>

        <span class="nb">SSLProtocol</span> <span class="k">all</span> -SSLv2
        <span class="nb">SSLCipherSuite</span> <span class="k">ALL</span>:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM

        <span class="nb">SSLCertificateFile</span>    <span class="sx">/etc/ssl/certs/mailserver.pem</span>
        <span class="nb">SSLCertificateKeyFile</span> <span class="sx">/etc/ssl/certs/private/mailserver.pem</span>
        <span class="nb">SSLCertificateChainFile</span> <span class="sx">/etc/ssl/certs/sub.class1.mail.ca.pem</span>

       <span class="nt">&lt;FilesMatch</span> <span class="s">&quot;\.(cgi|shtml|phtml|php)$&quot;</span><span class="nt">&gt;</span>
                <span class="nb">SSLOptions</span> +StdEnvVars
        <span class="nt">&lt;/FilesMatch&gt;</span>
        <span class="nt">&lt;Directory</span> <span class="s">/usr/lib/cgi-bin</span><span class="nt">&gt;</span>
                <span class="nb">SSLOptions</span> +StdEnvVars
        <span class="nt">&lt;/Directory&gt;</span>

        <span class="nb">BrowserMatch</span> <span class="s2">&quot;MSIE [2-6]&quot;</span> \   
                <span class="nb">nokeepalive</span> ssl-unclean-shutdown \
                <span class="err">downgrade-1</span>.<span class="err">0</span> <span class="err">force-response-1</span>.<span class="err">0</span>
        <span class="c"># MSIE 7 and newer should be able to use keepalive</span>
        <span class="nb">BrowserMatch</span> <span class="s2">&quot;MSIE [17-9]&quot;</span> ssl-unclean-shutdown

<span class="nt">&lt;/VirtualHost&gt;</span>
<span class="nt">&lt;/IfModule&gt;</span></code></pre></div>

<p>Then, edit the ports.conf file </p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">nano</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">apache2</span><span class="o">/</span><span class="nx">ports</span><span class="p">.</span><span class="nx">conf</span></code></pre></div>

<p>Leave it as the code below:</p>

<div class="highlight"><pre><code class="language-apacheconf" data-lang="apacheconf"><span class="nb">NameVirtualHost</span> *:80
<span class="nb">NameVirtualHost</span> *:443

<span class="nb">Listen</span> <span class="m">80</span>

<span class="nt">&lt;IfModule</span> <span class="s">mod_ssl.c</span><span class="nt">&gt;</span>
    <span class="nb">Listen</span> <span class="m">443</span>
<span class="nt">&lt;/IfModule&gt;</span>

<span class="nt">&lt;IfModule</span> <span class="s">mod_gnutls.c</span><span class="nt">&gt;</span>
    <span class="nb">Listen</span> <span class="m">443</span>
<span class="nt">&lt;/IfModule&gt;</span></code></pre></div>

<p>Maybe you need to disable previous configurations, before enabling the one we just setup:</p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">a2dissite</span> <span class="nx">default</span>
<span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">a2dissite</span> <span class="nx">default-ssl</span></code></pre></div>

<p>And enabling the new VirtualHosts</p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">a2ensite</span> <span class="nx">www</span><span class="p">.</span><span class="nx">mydomain</span><span class="p">.</span><span class="nx">com</span>
<span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">a2ensite</span> <span class="nx">mail</span><span class="p">.</span><span class="nx">mydomain</span><span class="p">.</span><span class="nx">com</span></code></pre></div>

<p>In order for Apache to update the new settings:</p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">service</span> <span class="nx">apache2</span> <span class="nx">reload</span>
<span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">service</span> <span class="nx">apache2</span> <span class="nx">restart</span></code></pre></div>

<p>We can test the webserver connection by typing in a web browser www.mydomain.com. In relation to the DNS settings that must be assigned for the previous to work, it just consists of an A record that points the domain root, without any preffix to the public IP, as well as a CNAME record that refers the www. preffixed domain to the domain name as in the following rules. But remember that these records might need up to 24 hours to fully propagate:</p>

<div class="highlight"><pre><code class="language-livescript" data-lang="livescript"><span class="nx">mydomain</span><span class="p">.</span><span class="nx">com</span><span class="p">.</span> <span class="mi">1800</span> <span class="nx">IN</span> <span class="nx">A</span> <span class="mf">111.22</span><span class="p">.</span><span class="mf">333.444</span>
<span class="nx">www</span><span class="p">.</span><span class="nx">mydomain</span><span class="p">.</span><span class="nx">com</span><span class="p">.</span> <span class="mi">1800</span> <span class="nx">IN</span> <span class="nx">CNAME</span> <span class="nx">mydomain</span><span class="p">.</span><span class="nx">com</span><span class="p">.</span></code></pre></div>

<p>If everything went OK the browser should automatically be redirected to https://www.mydomain.com. The lock at the left of the navigation bar should be green, and the browser should not warn of unsecure connections.</p>


  </article>


  
</div>

	<div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: THIS CODE IS ONLY AN EXAMPLE * * */
    var disqus_shortname = 'gostak'; // Required - Replace example with your forum shortname
    //var disqus_identifier = 'a unique identifier for each page where Disqus is present';
    //var disqus_title = 'a unique title for each page where Disqus is present';
    //var disqus_url = 'a unique URL for each page where Disqus is present';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>


              </div><!--//.wrapper-->
            </div><!--//.page-content-->

          </article><!--//.article-->
        </div> <!--//#main-->

      <footer class="site-footer">
    <div class="block">

  <div class="wrapper">

    <!--<h2 class="footer-heading">gostak.io</h2>-->

    <div class="footer-col-wrapper">
      
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li><a class="site-footer-inner" href="/donakis/">gostak.io</a></li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/maripac">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">maripac</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Suppose someone to assert: The gostak distims the doshes. You do not know what this means; nor do I. But if we assume that it is English, we know that the doshes are distimmed by the gostak. We know too that one distimmer of doshes is a gostak. If, moreover, the doshes are galloons, we know that some galloons are distimmed by the gostak. And so we may go on, and so we often do go on.
</p>
      </div>
    </div>

  </div>
  

</footer>


      </div><!--//#inner-->
    </div><!--//#outer-->

    <script src="/donakis/scripts/jquery.min.js"></script>
    <!--// <script language="javascript" type="text/javascript">
    //   $(function() {
    //     if($('pre').length >0 ){
    //       hljs.initHighlightingOnLoad();
    //     }
    //   });
    // </script>-->
    <script src="/donakis/scripts/main.js"></script>
    



  </body>
</html>
